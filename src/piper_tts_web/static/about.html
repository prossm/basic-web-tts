<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>My Library - Basic TTS</title>
  <link rel="stylesheet" href="/static/styles.css">
  <link rel="icon" href="/static/black-transparent-basictts-favicon.png" media="(prefers-color-scheme: light)">
  <link rel="icon" href="/static/white-transparent-basictts-favicon.png" media="(prefers-color-scheme: dark)">
</head>
<body>
  <header style="width:100%; background:#fff; box-shadow:0 2px 8px rgba(0,0,0,0.03); position:relative; z-index:10;">
    <nav style="display:flex; align-items:center; justify-content:space-between; max-width:1200px; margin:0 auto; padding:0.7em 2em;" aria-label="Main navigation">
      <a href="/" id="logo-link" style="display:flex; align-items:center; text-decoration:none;">
        <img src="/static/black-transparent-basictts-logo.png" alt="Basic TTS logo" style="height:38px; width:auto; margin-right:0.7em;">
      </a>
      <div style="display:flex; align-items:center; gap:2em;">
        <a href="/about" id="about-link" style="text-decoration:none; font-weight:500; font-size:1.1em; color:#222;">About</a>
        <span id="auth-links" style="display:none;">
          <a href="#" id="signup-link" style="font-weight: bold;">Sign Up</a> |
          <a href="#" id="login-link">Log In</a>
        </span>
        <span id="user-info" style="display:none;"></span>
      </div>
    </nav>
  </header>
  <main style="max-width:700px; margin:2em auto; background:#fff; border-radius:10px; box-shadow:0 2px 12px rgba(0,0,0,0.04); padding:2em 1.5em 2em 1.5em;">
    <h2 style="margin-bottom:1.5em;">My Library</h2>
    <ul id="library-list" style="list-style:none; padding:0; margin:0;"></ul>
  </main>
  <script src="/static/library.js"></script>
  <script>
let accountDropdownOpen = false;
let accountDropdown = null;
let accountDropdownCloseHandler = null;
function createOrToggleAccountDropdown() {
    const accountLinkEl = document.getElementById('account-link');
    let dropdown = document.getElementById('account-modal');
    if (dropdown && accountDropdownOpen) {
        dropdown.style.display = 'none';
        accountDropdownOpen = false;
        if (accountDropdownCloseHandler) {
            document.removeEventListener('mousedown', accountDropdownCloseHandler);
            accountDropdownCloseHandler = null;
        }
        return;
    }
    if (dropdown) dropdown.remove();
    // Create dropdown
    const rect = accountLinkEl.getBoundingClientRect();
    dropdown = document.createElement('div');
    dropdown.id = 'account-modal';
    dropdown.className = 'modal';
    dropdown.style.display = 'block';
    dropdown.style.position = 'absolute';
    dropdown.style.top = (window.scrollY + rect.bottom + 8) + 'px';
    dropdown.style.left = (window.scrollX + rect.right - 240) + 'px';
    dropdown.style.width = '240px';
    dropdown.style.background = '#fff';
    dropdown.style.borderRadius = '10px';
    dropdown.style.boxShadow = '0 4px 24px rgba(0,0,0,0.13)';
    dropdown.style.zIndex = '1000';
    dropdown.style.padding = '1.2em 0 0.5em 0';
    dropdown.innerHTML = `
      <ul id="account-options" style="list-style:none; padding:0 0 0.5em 0; margin:0;">
        <li><a href="/library" id="my-library-link" class="account-link" style="display:block; padding:0.7em 1.5em;">My Library</a></li>
        <li><a href="/terms" class="account-link" style="display:block; padding:0.7em 1.5em;">Terms of Service</a></li>
        <li><a href="/privacy" class="account-link" style="display:block; padding:0.7em 1.5em;">Privacy Policy</a></li>
      </ul>
      <button id="logout-button" class="btn btn-secondary" style="margin:0.5em 1.5em 0.5em 1.5em; width:calc(100% - 3em);">Log Out</button>
    `;
    document.body.appendChild(dropdown);
    accountDropdownOpen = true;
    accountDropdown = dropdown;
    // Close dropdown if click outside or on Account again
    accountDropdownCloseHandler = function(e) {
        if (!dropdown.contains(e.target) && e.target !== accountLinkEl) {
            dropdown.style.display = 'none';
            accountDropdownOpen = false;
            document.removeEventListener('mousedown', accountDropdownCloseHandler);
            accountDropdownCloseHandler = null;
        }
    };
    setTimeout(() => {
        document.addEventListener('mousedown', accountDropdownCloseHandler);
    }, 0);
    // Close dropdown on link click
    dropdown.querySelectorAll('a').forEach(link => {
        link.addEventListener('click', () => {
            dropdown.style.display = 'none';
            accountDropdownOpen = false;
            if (accountDropdownCloseHandler) {
                document.removeEventListener('mousedown', accountDropdownCloseHandler);
                accountDropdownCloseHandler = null;
            }
        });
    });
    // Log Out button logic
    const logoutButton = dropdown.querySelector('#logout-button');
    if (logoutButton) {
        logoutButton.onclick = async () => {
            if (window.firebase && window.firebase.auth) {
                await firebaseAuth.signOut();
            }
            dropdown.style.display = 'none';
            accountDropdownOpen = false;
            if (accountDropdownCloseHandler) {
                document.removeEventListener('mousedown', accountDropdownCloseHandler);
                accountDropdownCloseHandler = null;
            }
            document.getElementById('user-info').style.display = 'none';
            document.getElementById('auth-links').style.display = 'inline';
            window.location.href = '/';
        };
    }
}
function attachAccountDropdownHandler() {
    const accountLink = document.getElementById('account-link');
    if (accountLink) {
        accountLink.onclick = (e) => {
            e.preventDefault();
            createOrToggleAccountDropdown();
        };
    }
}
window.addEventListener('popstate', function() {
    const dropdown = document.getElementById('account-modal');
    if (dropdown) {
        dropdown.style.display = 'none';
        accountDropdownOpen = false;
        if (accountDropdownCloseHandler) {
            document.removeEventListener('mousedown', accountDropdownCloseHandler);
            accountDropdownCloseHandler = null;
        }
    }
});
document.addEventListener('DOMContentLoaded', function() {
  const userInfo = document.getElementById('user-info');
  if (userInfo && userInfo.querySelector('#account-link')) {
    attachAccountDropdownHandler();
  }
});
</script>
</body>
</html> 